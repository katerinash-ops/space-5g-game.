<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Realistic Space 5G Ultimate</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #000; 
            font-family: 'Arial Black', sans-serif; 
            touch-action: none; 
        }
        canvas { display: block; }
        
        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        #ui-layer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 10;
        }
        
        /* –ü–æ–ª–æ—Å–∞ —Å–∏–≥–Ω–∞–ª–∞ */
        #signal-container {
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            width: 30px; height: 300px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 15px;
            overflow: hidden;
        }
        #signal-fill {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 0%;
            background: linear-gradient(to top, #ff3d00, #ffeb3b, #00e676);
            transition: height 0.1s;
        }
        #signal-text {
             position: absolute; left: 60px; top: 50%;
             transform: translateY(-50%) rotate(-90deg);
             transform-origin: left center;
             color: #fff; font-size: 20px; font-weight: bold; letter-spacing: 2px;
             text-shadow: 2px 2px 4px #000;
             white-space: nowrap;
        }

        /* –≠–ö–†–ê–ù –°–¢–ê–†–¢–ê */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex; justify_content: center; align-items: center; flex-direction: column;
            color: white; z-index: 20; text-align: center;
            transition: opacity 0.5s;
            cursor: pointer;
        }
        h1 { 
            color: #00E676; 
            text-shadow: 0 0 20px rgba(0, 230, 118, 0.5); 
            font-size: 40px; margin-bottom: 10px; text-transform: uppercase;
        }
        p { font-size: 18px; color: #ddd; }
        .blink { animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="signal-container"><div id="signal-fill"></div></div>
    <div id="signal-text">NO SIGNAL</div>
</div>

<div id="start-screen">
    <h1>üöÄ 5G Mission</h1>
    <p>–¢—è–Ω–∏ —Ä–∞–∫–µ—Ç—É –í–ù–ò–ó –¥–ª—è –∑–∞–ø—É—Å–∫–∞</p>
    <p class="blink" style="font-size: 14px; margin-top: 20px; color: #888;">(–ù–∞–∂–º–∏ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)</p>
</div>

<canvas id="gameCanvas"></canvas>

<script>
// === –ù–ê–°–¢–†–û–ô–ö–ò ===
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const signalFill = document.getElementById('signal-fill');
const signalText = document.getElementById('signal-text');
const startScreen = document.getElementById('start-screen');

let width, height;
let audioCtx = null;

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
let gameState = 'IDLE'; // IDLE, DRAGGING, FLYING, WON
let cameraY = 0;

// –û–±—ä–µ–∫—Ç—ã
let slingshot = { x: 0, y: 0 };
let rocket = { x: 0, y: 0, vx: 0, vy: 0 };

// –°–ü–£–¢–ù–ò–ö–ò (Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–≤–µ—Ä—Ö, —Ç–æ –µ—Å—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
const satellites = [
    { id: "1G", y: -600, hit: false, color: "#FF5722" },
    { id: "2G", y: -1600, hit: false, color: "#FFC107" },
    { id: "3G", y: -3000, hit: false, color: "#CDDC39" },
    { id: "4G", y: -5000, hit: false, color: "#4CAF50" },
    { id: "5G", y: -7500, hit: false, color: "#00B0FF", final: true }
];

let particles = [];
let stars = [];

// === –ó–ê–ü–£–°–ö ===
function init() {
    resize();
    window.addEventListener('resize', resize);
    
    // –°–æ–∑–¥–∞–µ–º –ú–ù–û–ì–û –∑–≤–µ–∑–¥ –¥–ª—è –≥—É—Å—Ç–æ–≥–æ –∫–æ—Å–º–æ—Å–∞
    for(let i=0; i<600; i++) { // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 600
        stars.push({
            x: Math.random(), 
            y: Math.random(), 
            size: Math.random() * 2.5 + 0.5, 
            blink: Math.random()
        });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    const startInteraction = (e) => {
        if (!audioCtx) initAudio();
        startScreen.style.opacity = '0';
        setTimeout(() => startScreen.style.display = 'none', 500);
        onDown(e);
    };

    document.addEventListener('mousedown', startInteraction);
    document.addEventListener('touchstart', startInteraction, {passive: false});
    document.addEventListener('mousemove', onMove);
    document.addEventListener('touchmove', onMove, {passive: false});
    document.addEventListener('mouseup', onUp);
    document.addEventListener('touchend', onUp);

    resetGame();
    loop();
}

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    slingshot.x = width / 2;
    slingshot.y = height - 150;
    if(gameState === 'IDLE') {
        rocket.x = slingshot.x;
        rocket.y = slingshot.y;
    }
}

function resetGame() {
    gameState = 'IDLE';
    rocket.x = slingshot.x;
    rocket.y = slingshot.y;
    rocket.vx = 0; rocket.vy = 0;
    cameraY = 0;
    satellites.forEach(s => s.hit = false);
    particles = [];
    updateSignal(0);
}

// === –£–ü–†–ê–í–õ–ï–ù–ò–ï ===
function getPos(e) {
    if(e.changedTouches) return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
    return { x: e.clientX, y: e.clientY };
}

function onDown(e) {
    if(gameState === 'WON') { resetGame(); return; }
    if(gameState !== 'IDLE') return;
    
    const pos = getPos(e);
    if(Math.hypot(pos.x - rocket.x, pos.y - rocket.y) < 100) {
        gameState = 'DRAGGING';
        playTone(100, 0);
    }
}

function onMove(e) {
    if(gameState !== 'DRAGGING') return;
    e.preventDefault();
    const pos = getPos(e);
    
    let dx = pos.x - slingshot.x;
    let dy = pos.y - slingshot.y;
    
    const maxPull = 180;
    const dist = Math.hypot(dx, dy);
    const angle = Math.atan2(dy, dx);
    const pull = Math.min(dist, maxPull);
    
    if(dy < 0 && dist > 20) dy = 0; 

    rocket.x = slingshot.x + Math.cos(angle) * pull;
    rocket.y = slingshot.y + Math.sin(angle) * pull;
    
    updateTone(100 + (pull/maxPull)*300);
}

function onUp(e) {
    if(gameState !== 'DRAGGING') return;
    stopTone();
    
    const dx = slingshot.x - rocket.x;
    const dy = slingshot.y - rocket.y;
    
    const power = 0.28; 
    rocket.vx = dx * power;
    rocket.vy = dy * power;
    
    if(Math.hypot(rocket.vx, rocket.vy) < 3) {
        resetGame();
    } else {
        gameState = 'FLYING';
        playLaunchSound();
    }
}

// === –õ–û–ì–ò–ö–ê ===
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

function update() {
    if(gameState === 'FLYING' || gameState === 'WON') {
        rocket.x += rocket.vx;
        rocket.y += rocket.vy;
        
        if(gameState === 'FLYING') {
            rocket.vy += 0.05;
            rocket.vx *= 0.995;
            
            let targetCamY = -rocket.y + height * 0.6;
            if (targetCamY < 0) targetCamY = 0;
            cameraY += (targetCamY - cameraY) * 0.1;

            satellites.forEach(sat => {
                if(!sat.hit && Math.abs(rocket.y - sat.y) < 100 && Math.abs(rocket.x - width/2) < 250) {
                    sat.hit = true;
                    createExplosion(rocket.x, sat.y, sat.color);
                    playExplosionSound();
                    if(sat.final) {
                        gameState = 'WON';
                    }
                }
            });

            const totalDist = -satellites[satellites.length-1].y;
            const currentDist = slingshot.y - rocket.y;
            const percent = Math.min(100, Math.max(0, Math.floor((currentDist / totalDist) * 100)));
            updateSignal(percent);

            if(rocket.y > height + 200) resetGame();
        } 
        else if (gameState === 'WON') {
            rocket.vx *= 0.95;
            rocket.vy *= 0.95;
            cameraY -= 1;
            
            if(Math.random() < 0.05) {
                createExplosion(
                    Math.random()*width, 
                    -cameraY + Math.random()*height, 
                    `hsl(${Math.random()*360}, 100%, 50%)`
                );
            }
        }
    }

    for(let i=particles.length-1; i>=0; i--) {
        let p = particles[i];
        p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        if(p.life <= 0) particles.splice(i,1);
    }
}

function updateSignal(pct) {
    signalFill.style.height = pct + '%';
    signalText.innerText = pct < 100 ? `SIGNAL: ${pct}%` : "5G CONNECTED";
}

function createExplosion(x, y, color) {
    for(let i=0; i<30; i++) {
        particles.push({
            x: x, y: y,
            vx: (Math.random()-0.5) * 15,
            vy: (Math.random()-0.5) * 15,
            color: color,
            life: 1
        });
    }
}

// === –û–¢–†–ò–°–û–í–ö–ê ===
function draw() {
    // –¢–µ–º–Ω—ã–π —Ñ–æ–Ω
    ctx.fillStyle = '#000510';
    ctx.fillRect(0, 0, width, height);

    ctx.save();
    ctx.translate(0, cameraY);

    // –ó–≤–µ–∑–¥—ã (–º–Ω–æ–≥–æ –∏ —Ä–∞–∑–Ω–æ–π —è—Ä–∫–æ—Å—Ç–∏)
    ctx.fillStyle = "white";
    stars.forEach(s => {
        let starY = (s.y * 8000) - 3000; // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∑–≤–µ–∑–¥—ã –ø–æ –≤—ã—Å–æ—Ç–µ
        if(starY + cameraY > -100 && starY + cameraY < height + 100) {
            // –ú–µ—Ä—Ü–∞–Ω–∏–µ
            ctx.globalAlpha = Math.random() * 0.3 + 0.5; 
            ctx.beginPath(); ctx.arc(s.x * width, starY, s.size, 0, Math.PI*2); ctx.fill();
        }
    });
    ctx.globalAlpha = 1;

    ctx.fillStyle = "#2E7D32";
    ctx.fillRect(0, height - 100, width, 500);
    ctx.fillStyle = "#555";
    ctx.fillRect(width/2 - 50, height - 100, 100, 20);

    if(gameState === 'IDLE' || gameState === 'DRAGGING') {
        ctx.strokeStyle = "#5D4037"; ctx.lineWidth = 5;
        ctx.beginPath(); ctx.moveTo(slingshot.x-40, slingshot.y-30); ctx.lineTo(rocket.x, rocket.y); ctx.stroke();
    }

    satellites.forEach(sat => {
        if(!sat.hit) drawRealisticSatellite(sat);
    });

    drawRocket();

    if(gameState === 'IDLE' || gameState === 'DRAGGING') {
        ctx.strokeStyle = "#8D6E63"; ctx.lineWidth = 5;
        ctx.beginPath(); ctx.moveTo(rocket.x, rocket.y); ctx.lineTo(slingshot.x+40, slingshot.y-30); ctx.stroke();
        
        ctx.fillStyle = "#795548";
        ctx.fillRect(slingshot.x-45, slingshot.y-30, 10, 100);
        ctx.fillRect(slingshot.x+35, slingshot.y-30, 10, 100);
    }

    particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill();
    });
    ctx.globalAlpha = 1;

    ctx.restore();

    if(gameState === 'WON') {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0,0,width,height);
        
        ctx.textAlign = "center";
        ctx.fillStyle = "#00E676";
        ctx.font = "bold 50px Arial";
        ctx.fillText("5G CONNECTED!", width/2, height/2 - 20);
        
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.strokeText("5G CONNECTED!", width/2, height/2 - 20);

        ctx.fillStyle = "#fff";
        ctx.font = "20px Arial";
        ctx.fillText("Tap to Restart", width/2, height/2 + 40);
    }
}

// === –§–£–ù–ö–¶–ò–Ø –†–ò–°–û–í–ê–ù–ò–Ø –†–ï–ê–õ–ò–°–¢–ò–ß–ù–û–ì–û –°–ü–£–¢–ù–ò–ö–ê ===
function drawRealisticSatellite(sat) {
    let x = width/2;
    let y = sat.y;
    
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(1.2, 1.2); 

    // –°–û–õ–ù–ï–ß–ù–´–ï –ü–ê–ù–ï–õ–ò
    ctx.fillStyle = "#1565C0";
    ctx.strokeStyle = "#90CAF9";
    ctx.lineWidth = 1;

    // –õ–µ–≤–∞—è
    ctx.fillRect(-120, -20, 90, 40);
    ctx.strokeRect(-120, -20, 90, 40);
    ctx.beginPath();
    ctx.moveTo(-90, -20); ctx.lineTo(-90, 20);
    ctx.moveTo(-60, -20); ctx.lineTo(-60, 20);
    ctx.moveTo(-120, 0); ctx.lineTo(-30, 0);
    ctx.stroke();

    // –ü—Ä–∞–≤–∞—è
    ctx.fillRect(30, -20, 90, 40);
    ctx.strokeRect(30, -20, 90, 40);
    ctx.beginPath();
    ctx.moveTo(60, -20); ctx.lineTo(60, 20);
    ctx.moveTo(90, -20); ctx.lineTo(90, 20);
    ctx.moveTo(30, 0); ctx.lineTo(120, 0);
    ctx.stroke();

    // –ö–û–†–ü–£–°
    let grad = ctx.createLinearGradient(-30, 0, 30, 0);
    grad.addColorStop(0, "#B0BEC5");
    grad.addColorStop(0.5, "#ECEFF1");
    grad.addColorStop(1, "#B0BEC5");
    ctx.fillStyle = grad;
    
    ctx.beginPath();
    ctx.ellipse(0, 0, 30, 30, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = "#546E7A";
    ctx.stroke();

    ctx.fillStyle = "#FFD700";
    ctx.beginPath(); ctx.arc(0, -10, 10, 0, Math.PI*2); ctx.fill();

    ctx.strokeStyle = "#CFD8DC";
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(0, 30); ctx.lineTo(0, 50); ctx.stroke();
    ctx.beginPath(); ctx.arc(0, 53, 3, 0, Math.PI*2); ctx.fill();

    // === –¢–ï–ö–°–¢ (–û–ì–†–û–ú–ù–´–ô –ò –°–ù–ò–ó–£) ===
    ctx.font = "900 80px Arial Black"; // –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –∏ –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
    ctx.textAlign = "center";          // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
    ctx.textBaseline = "top";          // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –≤–µ—Ä—Ö—É

    const textY = 70; // –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ –ø–æ–¥ —Å–ø—É—Ç–Ω–∏–∫
    
    // –¢–æ–ª—Å—Ç–∞—è —á–µ—Ä–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
    ctx.strokeStyle = "black";
    ctx.lineWidth = 8;
    ctx.strokeText(sat.id, 0, textY);
    
    // –°–∞–º —Ç–µ–∫—Å—Ç —Ü–≤–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è
    ctx.fillStyle = sat.color;
    ctx.fillText(sat.id, 0, textY);

    ctx.restore();
}

function drawRocket() {
    ctx.save();
    ctx.translate(rocket.x, rocket.y);
    
    let angle = 0;
    if(gameState === 'DRAGGING') angle = Math.PI;
    else if(gameState !== 'IDLE') angle = Math.atan2(rocket.vy, rocket.vx) + Math.PI/2;
    
    ctx.rotate(angle);

    if(gameState === 'FLYING') {
        ctx.fillStyle = "#FF5722";
        ctx.beginPath();
        ctx.moveTo(-10, 30); ctx.lineTo(0, 60 + Math.random()*20); ctx.lineTo(10, 30);
        ctx.fill();
    }

    ctx.fillStyle = "white";
    ctx.beginPath(); ctx.ellipse(0, 0, 25, 50, 0, 0, Math.PI*2); ctx.fill();
    
    ctx.fillStyle = "#29B6F6";
    ctx.beginPath(); ctx.arc(0, -15, 12, 0, Math.PI*2); ctx.fill();
    
    ctx.fillStyle = "#D32F2F";
    ctx.beginPath(); ctx.moveTo(-25, 20); ctx.lineTo(-45, 50); ctx.lineTo(-25, 40); ctx.fill();
    ctx.beginPath(); ctx.moveTo(25, 20); ctx.lineTo(45, 50); ctx.lineTo(25, 40); ctx.fill();

    ctx.restore();
}

// === –ó–í–£–ö–ò ===
function initAudio() {
    try {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();
    } catch(e) {}
}

let osc = null, gain = null;

function playTone(freq, vol) {
    if(!audioCtx) return;
    if(osc) stopTone();
    osc = audioCtx.createOscillator();
    gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.type = 'sawtooth';
    osc.frequency.value = freq;
    gain.gain.value = vol;
    osc.start();
}

function updateTone(freq) {
    if(osc) osc.frequency.value = freq;
    if(gain) gain.gain.value = 0.1;
}

function stopTone() {
    if(osc) {
        osc.stop();
        osc.disconnect();
        osc = null;
    }
}

function playLaunchSound() {
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 1);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
    o.start(); o.stop(audioCtx.currentTime+1);
}

function playExplosionSound() {
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.type = 'square';
    o.frequency.setValueAtTime(100, audioCtx.currentTime);
    o.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.3);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
    o.start(); o.stop(audioCtx.currentTime+0.3);
}

window.onload = init;
</script>
</body>
</html>